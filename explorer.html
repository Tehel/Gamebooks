<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
                      "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
	<title>FileReader Example</title>

	<script src="phonegap.js" type="text/javascript" charset="utf-8"></script>
	<script language='Javascript' src='js/toolbox.js'></script>
	<script language='Javascript'>

    // Wait for PhoneGap to load
    //
	
	var rootDir;
	
    function onLoad()
	{
		trace( 'document loaded' );
        document.addEventListener("deviceready", devready, false);
    }

	function devready()
	{
		// PhoneGap is ready
		trace( 'device ready' );
		$( 'out' ).innerHTML = 'PhoneGat:\n' + toStr( PhoneGap, true, 2 );
/*		trace( 'LocalFileSystem:' + LocalFileSystem );
		trace( 'LocalFileSystem.PERSISTENT:' + LocalFileSystem.PERSISTENT );
		trace( 'gotFs:' + gotFs );
		trace( 'fail:' + fail );
		trace( 'LocalFileSystem.requestFileSystem:' + LocalFileSystem.requestFileSystem );
		window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFs, fail);
		//trace( window.requestFileSystem );
*/		trace( 'Sent filesystem request' );
	}

	function gotFs( fs )
	{
		trace( 'Got FS: ' + fs.name );
		// Filesystem is available
		rootDir = fs.root;
		trace( 'root name: ' + rootDir.name );
		trace( 'root name: ' + rootDir.fullPath );
	}
	
	function click()
	{
		trace( 'root name: ' + rootDir.name );
		trace( 'root name: ' + rootDir.fullPath );
	}

	// fs.root.getFile("readme.txt", null, gotFileEntry, fail);
	
    function gotFileEntry(fileEntry)
	{
        fileEntry.file(gotFile, fail);
    }

    function gotFile(file)
	{
        readDataUrl(file);
        readAsText(file);
    }

    function readDataUrl(file)
	{
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            trace("Read as data URL");
            trace(evt.target.result);
        };
        reader.readAsDataURL(file);
    }

    function readAsText(file)
	{
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            trace("Read as text");
            trace(evt.target.result);
        };
        reader.readAsText(file);
    }

    function fail(evt) { trace( evt.target.error.code ); }

    </script>
  </head>
  <body onload="onLoad()">
    <h1>Example</h1>
    <p onclick='click()'>Read File</p>
	<pre id='out'></pre>
  </body>
</html>
